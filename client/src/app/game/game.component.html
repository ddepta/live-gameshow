<div class="game-container" *ngIf="gameData && currentQuestion">
  <div
    class="content"
    [ngClass]="{
      'animate-out-left': isAnimatingOut && animationDirection === 'next',
      'animate-out-right': isAnimatingOut && animationDirection === 'prev',
      'animate-in-right': isAnimatingIn && animationDirection === 'next',
      'animate-in-left': isAnimatingIn && animationDirection === 'prev'
    }"
  >
    <!-- Question container - hidden for participants until sent by moderator -->
    <div
      class="game-view-container"
      *ngIf="isModerator || isQuestionVisibleToParticipants"
    >
      <div class="game-info">
        <div class="question-content">
          <!-- Left navigation arrow - only visible to moderator -->
          <div class="nav-left-container" *ngIf="isModerator">
            <button
              class="nav-arrow nav-arrow-left"
              [disabled]="currentQuestionIndex === 0 || isAnimating"
              (click)="previousQuestion()"
            >
              <ng-icon name="typChevronLeft"></ng-icon>
            </button>
            <!-- Empty div to match the structure of the right container -->
            <div class="nav-placeholder"></div>
          </div>

          <p class="question-text">{{ currentQuestion.question }}</p>

          <!-- Right navigation arrow - only visible to moderator -->
          <div class="nav-right-container" *ngIf="isModerator">
            <!-- Next question button - at the top -->
            <button
              class="nav-arrow nav-arrow-right"
              [disabled]="
                currentQuestionIndex === gameData.questions.length - 1 ||
                isAnimating
              "
              (click)="nextQuestion()"
            >
              <ng-icon name="typChevronRight"></ng-icon>
            </button>

            <!-- Eye buttons in a row below the next button -->
            <div class="eye-buttons-row">
              <!-- Hide button (left) -->
              <button
                class="nav-arrow nav-arrow-action hide-eye"
                [class.active]="!questionSentToParticipants"
                [disabled]="isAnimating || !questionSentToParticipants"
                (click)="setQuestionVisibility(false)"
                title="Frage ausblenden"
              >
                <ng-icon name="phosphorEyeSlash"></ng-icon>
              </button>

              <!-- Show button (right, aligned beneath next button) -->
              <button
                class="nav-arrow nav-arrow-action show-eye"
                [class.active]="questionSentToParticipants"
                [disabled]="isAnimating || questionSentToParticipants"
                (click)="setQuestionVisibility(true)"
                title="Frage an Teilnehmer senden"
              >
                <ng-icon name="phosphorEye"></ng-icon>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Answer section - exactly match question-content structure -->
      <div class="answer-container"></div>
      <div
        *ngIf="isModerator || isAnswerVisibleToParticipants"
        class="question-answer"
      >
        <!-- Left space - match nav-left-container structure -->
        <div class="answer-left-container"></div>

        <!-- Center answer text - match question-text structure -->
        <div
          class="correct-answer-text"
          [class.blurred]="isAnswerBlurred"
          (click)="toggleAnswerBlur()"
        >
          Antwort: {{ currentQuestion.correctAnswer }}
        </div>

        <!-- Right space - match nav-right-container structure exactly -->
        <div class="answer-right-container" *ngIf="isModerator">
          <!-- Eye buttons row - match the exact structure in question-content -->
          <div class="answer-eye-buttons-row">
            <button
              class="nav-arrow nav-answer-action hide-eye"
              [class.active]="!answerSentToParticipants"
              [disabled]="isAnimating || !answerSentToParticipants"
              (click)="setAnswerVisibility(false)"
              title="Antwort ausblenden"
            >
              <ng-icon name="phosphorEyeSlash"></ng-icon>
            </button>
            <button
              class="nav-arrow nav-answer-action show-eye"
              [class.active]="answerSentToParticipants"
              [disabled]="isAnimating || answerSentToParticipants"
              (click)="setAnswerVisibility(true)"
              title="Antwort an Teilnehmer senden"
            >
              <ng-icon name="phosphorEye"></ng-icon>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Game question options - only show when question is visible -->
    <ng-container *ngIf="isModerator || isQuestionVisibleToParticipants">
      <!-- Updated multiple choice section with conditional blur -->

      <!-- Updated multiple choice section with conditional blur -->
      <div
        class="options-container"
        *ngIf="currentQuestion.type === 'multipleChoice'"
        [class.moderator-content-blurred]="
          isModerator && !questionSentToParticipants
        "
      >
        <div class="options-grid">
          <div
            class="option-btn"
            *ngFor="let option of currentQuestion.options"
            [class.moderator-option]="isModerator"
            [class.correct-answer]="
              isModerator && option === currentQuestion.correctAnswer
            "
          >
            <p-button
              [outlined]="
                (isModerator && isAnswerBlurred) ||
                (isModerator &&
                  option !== currentQuestion.correctAnswer &&
                  !isAnswerBlurred) ||
                (!isModerator && selectedAnswer !== option)
              "
              (onClick)="!isModerator && selectAnswer(option)"
              styleClass="w-full"
              [disabled]="multipleChoiceSubmitted"
            >
              <span class="option-content">
                {{ option }}
                <!-- Add user avatars inside the button -->
                <span *ngIf="isModerator" class="inline-user-avatars">
                  <span
                    *ngFor="let user of getUsersForOption(option)"
                    class="user-avatar"
                    [title]="user.username"
                  >
                    {{ user.username.charAt(0).toUpperCase() }}
                  </span>
                </span>
              </span>
            </p-button>
          </div>
        </div>

        <!-- Multiple choice section confirm button - hide for moderator -->
        <button
          *ngIf="!isModerator"
          class="confirm-button"
          [class.submitted]="multipleChoiceSubmitted"
          (click)="confirmMultipleChoice()"
          [disabled]="!selectedAnswer"
        >
          <ng-icon
            [name]="
              multipleChoiceSubmitted
                ? 'phosphorCheckFatFill'
                : 'phosphorCheckFat'
            "
          ></ng-icon>
        </button>
      </div>

      <!-- Buzzer section with conditional blur -->
      <div
        class="buzzer-container"
        *ngIf="currentQuestion.type === 'buzzer'"
        [class.moderator-content-blurred]="
          isModerator && !questionSentToParticipants
        "
      >
        <app-buzzer
          [lobbyCode]="lobbyCode"
          [isModerator]="isModerator"
          size="large"
        ></app-buzzer>
      </div>

      <!-- Estimation section with conditional blur -->
      <div
        class="estimation-container"
        *ngIf="currentQuestion.type === 'estimation'"
        [class.moderator-content-blurred]="
          isModerator && !questionSentToParticipants
        "
      >
        <!-- Participant view - completely separate from moderator view -->
        <ng-container *ngIf="!isModerator">
          <div class="estimation-input-container">
            <textarea
              #estimationInput
              class="estimation-input"
              placeholder="Schätzung..."
              [disabled]="estimationSubmitted"
              (input)="adjustFontSize(estimationInput)"
            ></textarea>
          </div>

          <button
            class="confirm-button"
            [class.submitted]="estimationSubmitted"
            (click)="submitEstimation(estimationInput.value)"
            [disabled]="!estimationInput.value || estimationSubmitted"
          >
            <ng-icon
              [name]="
                estimationSubmitted
                  ? 'phosphorCheckFatFill'
                  : 'phosphorCheckFat'
              "
            ></ng-icon>
          </button>
        </ng-container>
      </div>
    </ng-container>

    <!-- Moderator view: Display submitted answers - only show for estimation questions -->
    <div
      class="submitted-answers-container"
      *ngIf="isModerator && currentQuestion.type === 'estimation'"
      [class.moderator-content-blurred]="
        isModerator && !questionSentToParticipants
      "
    >
      <h3 class="answers-heading">Eingegangene Antworten</h3>

      <div
        class="answers-list"
        *ngIf="currentQuestionAnswers && currentQuestionAnswers.length > 0"
      >
        <div class="answer-item" *ngFor="let answer of currentQuestionAnswers">
          <div class="answer-meta">
            <div class="answer-user">{{ answer.username }}</div>
            <div class="answer-type">
              {{
                answer.type === "multipleChoice"
                  ? "Multiple Choice"
                  : "Schätzung"
              }}
            </div>
          </div>
          <div class="answer-value">{{ answer.answer }}</div>
        </div>
      </div>
      <div
        class="no-answers"
        *ngIf="!currentQuestionAnswers || currentQuestionAnswers.length === 0"
      >
        <p>Noch keine Antworten eingegangen.</p>
      </div>
    </div>

    <!-- Show waiting message when question is not visible -->
    <div
      class="waiting-message"
      *ngIf="!isModerator && !isQuestionVisibleToParticipants"
    >
      <p>Bitte warte, bis der Moderator die Frage freigegeben hat.</p>
    </div>
  </div>

  <!-- Loading state -->
  <div class="loading-info" *ngIf="!gameData">
    <p>Spielinformationen werden geladen...</p>
  </div>
</div>
